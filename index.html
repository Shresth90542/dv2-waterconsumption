<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Malaysia Water — Production & Consumption</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vega libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="masthead">
    <div class="wrap masthead__inner">
      <div class="masthead__titles">
        <h1>Malaysia Water — Production &amp; Consumption</h1>
        <p class="subtitle">
          Trends, sector mix, state comparisons &amp; geospatial patterns (2000–2022)
        </p>
      </div>
      <span class="badge">Interactive</span>
    </div>
  </header>

  <main class="wrap">

    <!-- 1) MAP (FIRST) -->
    <section>
      <h2 class="section-title">1) Total Water Consumption by State (Map)</h2>
      <div class="card">
        <div class="chart-head"><p class="chart-title">Total Consumption (MLD) — State Choropleth</p></div>
        <div id="map_totals" class="viz viz--map"></div>
        <p class="caption">
          The choropleth map visualises the total daily water consumption (MLD) for each Malaysian state.
          Darker shades indicate higher overall usage, with <strong>Selangor</strong> leading significantly due to its population density and industrial/commercial activity.
          Other high-consumption states include <strong>Johor</strong>, <strong>Perak</strong>, and <strong>Penang</strong>, while <strong>Perlis</strong> and <strong>Labuan</strong>
          exhibit lower demand. The pattern highlights geographic disparities in water utilisation.
        </p>
      </div>
    </section>

    <!-- 2) NATIONAL PRODUCTION -->
    <section>
      <h2 class="section-title">2) National Water Production (2000–2019)</h2>
      <div class="card">
        <div class="chart-head"><p class="chart-title">Malaysia — Total Water Production</p></div>
        <div id="line" class="viz"></div>
        <p class="caption">
          National production rises steadily from ~<strong>10,000 MLD</strong> in 2000 to over <strong>16,000 MLD</strong> in 2019.
          Mild year-to-year fluctuations align with supply capacity changes, new connections, and demand growth.
        </p>
      </div>
    </section>

    <!-- 3–4) STATE COMPARISONS -->
    <section>
      <h2 class="section-title">3–4) State Comparisons (same year)</h2>

      <div class="grid grid-2">
        <div class="card">
          <div class="chart-head"><p class="chart-title">Sectoral Water Consumption by State</p></div>
          <div id="bars" class="viz"></div>
          <p class="caption">
            Stacked bars show each state’s split between <em>Domestic</em> and <em>Non-domestic</em> use.
            Household consumption dominates nationwide—especially in urbanised states like <strong>Selangor</strong> and <strong>Johor</strong>—
            while states with strong industrial/tourism sectors (e.g., <strong>Penang</strong>, <strong>Melaka</strong>) exhibit a more balanced mix.
          </p>
        </div>

        <div class="card">
          <div class="chart-head"><p class="chart-title">Water Production vs Total Consumption</p></div>
          <div id="scatter" class="viz"></div>
          <p class="caption">
            Each point is a state for the selected year. Points near the diagonal indicate equilibrium between supply and demand.
            Above the line (e.g., <strong>Perak</strong>) suggests potential surpluses; below (e.g., <strong>Kedah</strong>) suggests deficits and
            reliance on transfers. This view highlights regional efficiency and distribution planning needs.
          </p>
        </div>
      </div>
    </section>

    <!-- 5) AREA -->
    <section>
      <h2 class="section-title">5) Malaysia Consumption by Sector (2003–2022)</h2>
      <div class="card">
        <div class="chart-head"><p class="chart-title">Domestic &amp; Non-domestic Over Time</p></div>
        <div id="area" class="viz"></div>
        <p class="caption">
          Total consumption increases over time with a consistently larger domestic share, reflecting population growth and urbanisation.
          Non-domestic consumption also grows, showing rising industrial and commercial activity.
        </p>
      </div>
    </section>

    <!-- 6) PER-STATE TRENDS -->
    <section>
      <h2 class="section-title">6) State Consumption Trends (2003–2022)</h2>
      <div class="card">
        <div class="chart-head"><p class="chart-title">Water Consumption Trend by State</p></div>
        <div id="sparklines" class="viz"></div>
        <p class="caption">
          Use the in-chart dropdown to select a state. Urban states show steeper growth trends compared with smaller states,
          consistent with population and economic expansion.
        </p>
      </div>
    </section>

  </main>

  <footer class="site-footer">
    <div class="wrap site-footer__inner">
      <p>
        <strong>Data sources:</strong>
        <code>water_production_2000_2019.csv</code>,
        <code>water_consumption.csv</code>,
        <code>state_totals.csv</code>
      </p>
      <p>Prepared by <strong>Shresth Sohaney</strong> (Student ID: <strong>33806314</strong>)</p>
    </div>
  </footer>

  <script>
    // IMPORTANT: giving each viz a reliable height prevents “blank chart” issues.
    const opts = { actions: false, renderer: 'canvas' };

    vegaEmbed('#map_totals',   'map_state_totals.json', opts).catch(console.error);
    vegaEmbed('#line',         'linechart.json',        opts).catch(console.error);
    vegaEmbed('#bars',         'bars.json',             opts).catch(console.error);
    vegaEmbed('#scatter',      'scatter.json',          opts).catch(console.error);
    vegaEmbed('#area',         'area.json',             opts).catch(console.error);
    vegaEmbed('#sparklines',   'state_sparklines.json', opts).catch(console.error);
  </script>
</body>
</html>
