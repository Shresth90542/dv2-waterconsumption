{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "title": "Water Production by State (MLD)",
  "width": 900,
  "height": 520,
  "projection": {"type": "mercator"},
  "params": [
    {"name": "year", "value": 2019, "bind": {"input": "range", "min": 2000, "max": 2019, "step": 1}}
  ],
  "data": {
    "url": "https://raw.githubusercontent.com/Shresth90542/dv2-waterconsumption/main/water_production_2000_2019.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {"calculate": "toNumber(datum.Year)", "as": "YearNum"},
    {"calculate": "toNumber(datum['Value (Million litres per day)'])", "as": "ProdMLD"},
    {
      "calculate": "replace(replace(datum.State,'W.P. Labuan','Labuan'),'Pulau Pinang','Pulau Pinang')",
      "as": "state_norm"
    },
    {"filter": "datum.YearNum == year && datum.state_norm != 'Malaysia'"},
    {
      "lookup": "state_norm",
      "from": {
        "data": {
          "url": "https://gist.githubusercontent.com/heiswayi/8a9b39dcf749c31a/raw/b2b83685f5205aee7c35f0b543201907660fac55e/malaysia.geojson",
          "format": {"type": "json"}
        },
        "key": "properties.name",
        "fields": ["type", "properties", "geometry"]
      }
    }
  ],
  "mark": {"type": "geoshape", "stroke": "#fff", "strokeWidth": 0.5},
  "encoding": {
    "shape": {"field": "geometry", "type": "geojson"},
    "color": {
      "field": "ProdMLD",
      "type": "quantitative",
      "scale": {"scheme": "blues"},
      "title": "Production (MLD)"
    },
    "tooltip": [
      {"field": "state_norm", "title": "State"},
      {"field": "YearNum", "title": "Year"},
      {"field": "ProdMLD", "type": "quantitative", "title": "Production (MLD)"}
    ]
  }
}
