{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 520,
  "height": 520,
  "data": {
    "url": "https://raw.githubusercontent.com/Shresth90542/dv2-waterconsumption/main/water_consumption.csv",
    "format": {"type": "csv"}
  },
  "params": [
    {"name": "yrSc", "value": 2019, "bind": {"input": "range", "min": 2003, "max": 2022, "step": 1}}
  ],
  "transform": [
    {"calculate": "year(toDate(datum.date))", "as": "Year"},
    {"filter": "datum.state != 'Malaysia' && datum.Year == yrSc"},
    {"aggregate": [{"op": "sum", "field": "value", "as": "total_cons"}], "groupby": ["state", "Year"]},

    {
      "calculate":
        "datum.state=='W.P. Labuan' ? 'W.P.Labuan' : " +
        "(datum.state=='Penang' ? 'Pulau Pinang' : (datum.state=='Malacca' ? 'Melaka' : datum.state))",
      "as": "state_for_prod"
    },

    {
      "lookup": "state_for_prod",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/Shresth90542/dv2-waterconsumption/main/water_production_2000_2019.csv",
          "format": {"type": "csv"}
        },
        "key": "State",
        "fields": ["State", "Year", "Value (Million litres per day)"]
      }
    },
    {"filter": "datum.Year == yrSc"}
  ],
  "mark": {"type": "point"},
  "encoding": {
    "x": {"field": "Value (Million litres per day)", "type": "quantitative", "title": "Production (MLD)"},
    "y": {"field": "total_cons", "type": "quantitative", "title": "Total consumption (MLD)"},
    "tooltip": [
      {"field": "state", "type": "nominal", "title": "State"},
      {"field": "Value (Million litres per day)", "type": "quantitative", "title": "Production (MLD)"},
      {"field": "total_cons", "type": "quantitative", "title": "Total consumption (MLD)"},
      {"field": "Year", "type": "ordinal", "title": "Year"}
    ]
  }
}
