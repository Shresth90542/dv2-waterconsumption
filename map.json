{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 980,
  "height": 560,
  "projection": {"type": "mercator"},
  "params": [
    {"name": "yrMap", "value": 2019, "bind": {"input": "range", "min": 2000, "max": 2019, "step": 1}}
  ],
  "data": {
    "url": "https://gist.githubusercontent.com/heiswayi/81a169ab39dcf749c31a/raw/b2b3685f5205aee7c35f0b543201907660fac55e/malaysia.geojson",
    "format": {"type": "json", "property": "features"}
  },
  "transform": [
    {
      "calculate": "datum.properties.name",
      "as": "geo_name"
    },
    {
      "lookup": "geo_name",
      "from": {
        "data": {
          "values": [
            {"geo":"Penang","csv":"Pulau Pinang"},
            {"geo":"Malacca","csv":"Melaka"},
            {"geo":"Kuala Lumpur","csv":"W.P. Kuala Lumpur"},
            {"geo":"Labuan","csv":"W.P.Labuan"},
            {"geo":"Putrajaya","csv":"W.P. Putrajaya"},
            {"geo":"Wilayah Persekutuan Kuala Lumpur","csv":"W.P. Kuala Lumpur"},
            {"geo":"Wilayah Persekutuan Labuan","csv":"W.P.Labuan"},
            {"geo":"Wilayah Persekutuan Putrajaya","csv":"W.P. Putrajaya"}
          ]
        },
        "key": "geo",
        "fields": ["csv"]
      },
      "as": "mapped_csv_name"
    },
    {"calculate": "datum.mapped_csv_name ? datum.mapped_csv_name : datum.geo_name", "as": "state_key"},
    {
      "lookup": "state_key",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/Shresth90542/dv2-waterconsumption/main/water_production_2000_2019.csv",
          "format": {"type": "csv"}
        },
        "key": "State",
        "fields": ["State", "Year", "Value (Million litres per day)"]
      }
    },
    {"filter": "datum.Year == yrMap"}
  ],
  "mark": {"type": "geoshape", "stroke": "#fff", "strokeWidth": 0.7},
  "encoding": {
    "color": {
      "field": "Value (Million litres per day)",
      "type": "quantitative",
      "title": "Water Production (MLD)",
      "scale": {"scheme": "blues"}
    },
    "tooltip": [
      {"field": "state_key", "type": "nominal", "title": "State"},
      {"field": "Value (Million litres per day)", "type": "quantitative", "title": "Production (MLD)"},
      {"field": "Year", "type": "ordinal", "title": "Year"}
    ]
  }
}
